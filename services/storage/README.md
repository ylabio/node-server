# Сервис хранилища

Реализует типовые функции работы с данными - выборку, сохранение, удаление в субд MongoDB

При инициализации передаются параметры соединения с базой.
Сервисы, которым необходимо работать с базой определяют параметры коллекции и получают объект-обертку для
работы с указанной коллекцией.

Указывается название коллекции, схемы валидации и парамтеры индексов. 

```js
const storage = await this.services.getStorage();

let dbCities = await storage.define({
  name: 'cities',
  schemes: {
    create: '#/components/schemas/city.create',
    update: '#/components/schemas/city.update',
    view: '#/components/schemas/city.view'
  },
  indexes: {
    countryId: [{'countryId': 1}],
  }
});
```

Параметры индексов соответсвуют MongoDB параметрам.
В качестве схем указываются отсительные пути на схемы валидации перед созданием (create) и изменением (update) 
и схема фильтрации перед выводом (view). Вместо пути на схему можно указать функцию для реализации кастомной
валидации. В функцию валидации передаётся один параметр - валидируемый объект. Если объект не валидный, то нужно
выбросить исключение. Функция валидация вызывается асинхронно.

Допустимо создать несколько определний на одну коллекцию, но этого следует избегать. Работать с коллекциями другого
сервиса напрмую не рекомендуется. При повторном опредлении параметры тех же идексов не переопределются.

При необходимости дополнительных опреаций с монгой, не реализуемых через storage можно обратиться к нативной коллекции
```js
let result = await dbCities.native.find({});
```
